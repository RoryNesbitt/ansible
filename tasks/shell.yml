- name: Install shells
  hosts: home
  tasks:

    - name: Install shells
      package:
        name:
          - zsh
          - dash
        state: present
      become: true

    - name: Set default shell to dash
      shell: |
        rm -f /bin/sh
        ln -s /bin/dash /bin/sh
      become: true

    - name: Set user shell to dash
      user:
        name: rory
        shell: /bin/zsh
      become: true

    - name: Download dotfiles
      git:
        clone: true
        bare: true
        repo: git@github.com:RoryNesbitt/dotfiles
        dest: $HOME/.config/dotfiles
        update: false

    - name: Checkout dotfiles
      shell: |
        git --git-dir=$HOME/.config/dotfiles --work-tree=$HOME checkout
        git --git-dir=$HOME/.config/dotfiles --work-tree=$HOME pull
